# FitTrack Pro v1.2 Setup Guide

## What's New in v1.2

### âœ… Completed Features

1. **Comprehensive Workout Tracking System**
   - Exercise library with 6+ metadata fields
   - Nested workout creation (workout â†’ setgroups â†’ sets)
   - Progress tracking per exercise with history
   - Client workout statistics and streaks
   - 20+ REST API endpoints

2. **PDF Generation System**
   - Workout log PDFs with tables and volume calculations
   - Meal plan PDFs with nutrition breakdowns
   - Progress report PDFs with measurements, achievements, quests
   - Health statistics PDFs with aggregated metrics
   - Professional styling with branded colors

3. **Email System**
   - SMTP integration with multiple providers supported
   - HTML email templates with responsive design
   - PDF attachment support
   - 4 email types (workout, meal plan, progress, health stats)
   - Customizable branding

### ðŸš§ In Development

- Workout UI components (frontend)
- Trainer dashboard with analytics
- Calendar view component
- Achievement tier enhancements

## Installation

### Prerequisites

- Python 3.8+
- Node.js 16+
- Git

### Backend Setup

1. **Navigate to backend directory**:
```bash
cd backend
```

2. **Create virtual environment** (recommended):
```bash
# Windows
python -m venv venv
venv\Scripts\activate

# macOS/Linux
python3 -m venv venv
source venv/bin/activate
```

3. **Install dependencies**:
```bash
pip install -r requirements.txt
```

4. **Configure environment variables**:

Copy `.env.example` to `.env`:
```bash
# Windows
copy .env.example .env

# macOS/Linux
cp .env.example .env
```

Edit `.env` with your settings:
```env
# Database
DATABASE_URL=sqlite:///./backend_data.db

# SMTP Email Configuration
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
FROM_EMAIL=your-email@gmail.com
FROM_NAME=FitTrack Pro

# JWT Authentication
SECRET_KEY=your-secret-key-here-change-this
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
```

5. **Start the server**:
```bash
uvicorn app.main:app --reload
```

Server will start at: `http://localhost:8000`

6. **Verify installation**:

Visit `http://localhost:8000/docs` to see the interactive API documentation.

### Frontend Setup

1. **Navigate to web-client directory**:
```bash
cd web-client
```

2. **Install dependencies**:
```bash
npm install
```

3. **Start development server**:
```bash
npm run dev
```

Frontend will start at: `http://localhost:5173`

## Email Configuration

### Gmail Setup (Recommended for Testing)

1. **Enable 2-Factor Authentication**:
   - Go to Google Account settings
   - Security â†’ 2-Step Verification
   - Enable 2FA

2. **Generate App Password**:
   - Go to: https://myaccount.google.com/apppasswords
   - Select app: "Mail"
   - Select device: "Other" (enter "FitTrack Pro")
   - Click "Generate"
   - Copy the 16-character password

3. **Update `.env`**:
```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=abcd efgh ijkl mnop  # App password from step 2
FROM_EMAIL=your-email@gmail.com
FROM_NAME=FitTrack Pro
```

### SendGrid Setup (Recommended for Production)

1. **Create SendGrid account**: https://sendgrid.com

2. **Generate API key**:
   - Settings â†’ API Keys â†’ Create API Key
   - Select "Full Access"
   - Copy the key

3. **Update `.env`**:
```env
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USER=apikey
SMTP_PASSWORD=SG.xxxxxxxxxxxxx  # Your SendGrid API key
FROM_EMAIL=verified@yourdomain.com
FROM_NAME=FitTrack Pro
```

### Mailgun Setup

1. **Create Mailgun account**: https://mailgun.com

2. **Get SMTP credentials**:
   - Dashboard â†’ Sending â†’ Domain settings
   - SMTP credentials tab

3. **Update `.env`**:
```env
SMTP_HOST=smtp.mailgun.org
SMTP_PORT=587
SMTP_USER=postmaster@yourdomain.mailgun.org
SMTP_PASSWORD=your-mailgun-password
FROM_EMAIL=noreply@yourdomain.com
FROM_NAME=FitTrack Pro
```

## Testing the System

### 1. Test API Endpoints

Visit `http://localhost:8000/docs` and test:

**Exercise Management**:
- POST `/workouts/exercises` - Create exercise
- GET `/workouts/exercises` - List exercises

**Workout Creation**:
- POST `/workouts/` - Create workout with nested data

**PDF Generation**:
- GET `/pdf/workout/{id}` - Download workout PDF

**Email Sending**:
- POST `/email/send-workout` - Send workout email

### 2. Test PDF Generation

```bash
# Using curl (after creating a workout)
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:8000/pdf/workout/1 \
  --output workout.pdf
```

### 3. Test Email Sending

```bash
# Using curl
curl -X POST \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"workout_id": 1}' \
  http://localhost:8000/email/send-workout
```

### 4. Create Sample Data

Use the interactive API docs (`/docs`) to:

1. Create a trainer account
2. Create a client
3. Create exercises (Bench Press, Squats, etc.)
4. Create a workout with setgroups and sets
5. Generate and download PDFs
6. Send emails

## Database Setup

### SQLite (Default)

No additional setup needed. Database file is created automatically at `backend/backend_data.db`.

### PostgreSQL (Production)

1. **Install PostgreSQL**

2. **Create database**:
```sql
CREATE DATABASE fittrack_pro;
```

3. **Update `.env`**:
```env
DATABASE_URL=postgresql://username:password@localhost/fittrack_pro
```

4. **Remove SQLite check** from `main.py`:
```python
# Remove or comment out this line:
# connect_args={"check_same_thread": False}

# Use this instead:
engine = create_engine(DATABASE_URL)
```

### MySQL (Alternative)

1. **Create database**:
```sql
CREATE DATABASE fittrack_pro CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

2. **Update `.env`**:
```env
DATABASE_URL=mysql+pymysql://username:password@localhost/fittrack_pro
```

3. **Install MySQL driver**:
```bash
pip install pymysql
```

## API Documentation

### Access Interactive Docs

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### Key Endpoints

#### Workout Tracking
- `GET /workouts/exercises` - List exercises
- `POST /workouts/` - Create workout with nested setgroups/sets
- `GET /workouts/clients/{id}/stats` - Get client statistics

#### PDF Generation
- `GET /pdf/workout/{id}` - Download workout PDF
- `GET /pdf/meal-plan/{id}` - Download meal plan PDF
- `GET /pdf/progress-report/{id}` - Download progress report
- `GET /pdf/health-stats/{id}` - Download health statistics

#### Email System
- `POST /email/send-workout` - Email workout plan
- `POST /email/send-meal-plan` - Email meal plan
- `POST /email/send-progress-report` - Email progress report
- `POST /email/send-health-stats` - Email health stats

## Troubleshooting

### Common Issues

#### 1. Import Errors

**Problem**: `ModuleNotFoundError: No module named 'reportlab'`

**Solution**:
```bash
pip install -r requirements.txt
```

#### 2. Database Errors

**Problem**: `no such table: workout`

**Solution**: Tables are created automatically on startup. Restart the server:
```bash
uvicorn app.main:app --reload
```

#### 3. Email Sending Fails

**Problem**: "Failed to send email"

**Solutions**:
- Verify SMTP credentials in `.env`
- Check firewall not blocking port 587
- For Gmail, ensure App Password is used (not regular password)
- Check spam folder for test emails

#### 4. PDF Generation Fails

**Problem**: Blank PDFs or generation errors

**Solutions**:
- Ensure workout has data (setgroups and sets)
- Check matplotlib backend: `matplotlib.use('Agg')`
- Verify reportlab installed: `pip list | grep reportlab`

#### 5. CORS Errors (Frontend)

**Problem**: "Access-Control-Allow-Origin" errors

**Solution**: CORS is configured for all origins in development. For production, update `main.py`:
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://yourdomain.com"],  # Specific origins
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### Getting Help

1. Check documentation in `/docs` folder
2. Review API docs at `/docs` endpoint
3. Check server logs for error messages
4. Verify environment variables are set correctly

## Production Deployment

### Security Checklist

- [ ] Change `SECRET_KEY` to random secure value
- [ ] Use PostgreSQL instead of SQLite
- [ ] Configure specific CORS origins
- [ ] Use environment-specific `.env` files
- [ ] Enable HTTPS/SSL
- [ ] Set up rate limiting
- [ ] Configure proper logging
- [ ] Use production SMTP service (SendGrid, Mailgun)
- [ ] Implement database backups
- [ ] Set up monitoring and alerts

### Environment Variables

Create production `.env`:
```env
# Production Database
DATABASE_URL=postgresql://user:password@prod-db:5432/fittrack_pro

# Production SMTP
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USER=apikey
SMTP_PASSWORD=production-api-key

# Security
SECRET_KEY=production-secret-key-256-bits
ACCESS_TOKEN_EXPIRE_MINUTES=60

# URLs
FRONTEND_URL=https://app.fittrackpro.com
BACKEND_URL=https://api.fittrackpro.com
```

### Deployment Options

**Docker**:
```dockerfile
# Dockerfile
FROM python:3.10
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

**Railway/Render**: Upload repo and configure environment variables

**AWS/GCP/Azure**: Use container services with environment variables

## Next Steps

1. **Customize PDFs**: Edit `pdf_generator.py` to match your branding
2. **Customize Emails**: Edit templates in `email_service.py`
3. **Add Exercises**: Populate exercise library via API
4. **Create Workouts**: Start creating client workout programs
5. **Test Email Flow**: Send test emails to verify SMTP configuration
6. **Build Frontend**: Implement UI components for workout tracking
7. **Add Analytics**: Build trainer dashboard with client insights

## Resources

- **API Documentation**: `/docs` endpoint
- **Workout Tracking Guide**: `docs/workout-tracking.md`
- **PDF/Email Guide**: `docs/pdf-email-system.md`
- **Feature Checklist**: `FEATURE_CHECKLIST.md`
